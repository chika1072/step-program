# 遺伝的アルゴリズムを用いて巡回セールスマン問題を解く

## 概要
巡回セールスマン問題を解くにあたって、遺伝的アルゴリズムを用いたPythonの解法の実装を試みた。

## 特徴 (説明は後述)
- 分散遺伝的アルゴリズムを用いている
- 初代の生成に貪欲法と2-optを採用
- 親の選択はトーナメント形式
- 交叉は部分写像交叉
- 子の評価は距離の短い順
- 計算の終わりは世代数で決定

## 実装した遺伝的アルゴリズムの流れ
### Initialization
それぞれの島に対して、貪欲法と2-optである程度短い経路のpathを生成
### Selection
トーナメント方式で親となるpathの組を作成
### Crossover
部分写像交叉 (Partially Mapped Crossover) を用いて交叉 
### Evaluation
交叉した子の中で、ルートの短い順に島の中のpathの数だけ選択
### Imigration
次のindexの島に、前の島の何割かの子を移住させる

## 参考にした文献と自分のコードへの反映について
### 遺伝的アルゴリズム
アルゴリズムの流れを参考にした。
- [Pythonで入門 遺伝的アルゴリズム #Python3 - Qiita](https://qiita.com/simonritchie/items/d7f1596e7d034b9422ce)
- [遺伝的アルゴリズム](https://informatics.sist.ac.jp/suganuma/kougi/other_lecture/SE/opt/GA/GA.htm#:~:text=%E3%81%82%E3%82%8B%E4%B8%8E%E3%81%88%E3%82%89%E3%82%8C%E3%81%9F%E7%A2%BA%E7%8E%87%20P%20m%20%EF%BC%88%E7%AA%81%E7%84%B6%E5%A4%89%E7%95%B0%E7%8E%87%EF%BC%89%E3%81%A7%EF%BC%8C,%E7%AA%81%E7%84%B6%E5%A4%89%E7%95%B0%20%E3%82%92%E8%B5%B7%E3%81%93%E3%81%95%E3%81%9B%E3%81%BE%E3%81%99%EF%BC%8E%E4%B8%80%E8%88%AC%E7%9A%84%E3%81%AB%EF%BC%8C%E7%AA%81%E7%84%B6%E5%A4%89%E7%95%B0%E3%81%AF%EF%BC%8C%E5%B1%80%E6%89%80%E7%9A%84%E6%9C%80%E9%81%A9%E8%A7%A3%E3%81%8B%E3%82%89%E3%81%AE%E8%84%B1%E5%87%BA%E3%81%AB%E5%8A%B9%E6%9E%9C%E3%81%8C%E3%81%82%E3%82%8A%E3%81%BE%E3%81%99%EF%BC%8E%E3%81%97%E3%81%8B%E3%81%97%EF%BC%8C%E7%AA%81%E7%84%B6%E5%A4%89%E7%95%B0%E7%8E%87%E3%82%92%E5%A4%A7%E3%81%8D%E3%81%8F%E3%81%99%E3%82%8B%E3%81%A8%EF%BC%8C%E3%83%A9%E3%83%B3%E3%83%80%E3%83%A0%E6%8E%A2%E7%B4%A2%E3%81%AB%E8%BF%91%E3%81%84%E7%8A%B6%E6%85%8B%E3%81%AB%E3%81%AA%E3%82%8A%E3%81%BE%E3%81%99%E3%81%AE%E3%81%A7%EF%BC%8C%E9%80%9A%E5%B8%B8%EF%BC%8C%E5%B0%8F%E3%81%95%E3%81%AA%E5%80%A4%E3%81%8C%E4%BD%BF%E7%94%A8%E3%81%95%E3%82%8C%E3%81%BE%E3%81%99%EF%BC%8E%E7%AA%81%E7%84%B6%E5%A4%89%E7%95%B0%E6%96%B9%E6%B3%95%E3%81%A8%E3%81%97%E3%81%A6%E3%81%AF%EF%BC%8C%E4%BB%A5%E4%B8%8B%E3%81%AE%E3%82%88%E3%81%86%E3%81%AA%E3%82%82%E3%81%AE%E3%81%8C%E3%81%82%E3%82%8A%E3%81%BE%E3%81%99%EF%BC%8E%20%E5%90%84%E5%80%8B%E4%BD%93%E3%81%AE%E8%A9%95%E4%BE%A1%20%E5%90%84%E5%80%8B%E4%BD%93%E3%81%AE%E9%81%A9%E5%90%88%E5%BA%A6%E3%82%92%E8%A8%88%E7%AE%97%E3%81%97%E3%81%BE%E3%81%99%EF%BC%8E)

### 分散遺伝的アルゴリズム
分散遺伝的アルゴリズム：母集団を複数のサブ母集団（Subpopulation）に分割し，各サブ母集団内で独立した遺伝的操作を行う．サブ母集団を島（Island）とも呼ぶ．また，Fig. 7 (省略) のように一定世代ごとに島ごとで個体の交換を行う．この操作を移住（Migration）という．また移住において，島内の個体数に対して交換する個体数の割合を移住率（Migration rate）といい，移住を行う世代間隔を移住間隔（Migrationinterval）という. 
(廣安知之・三木光範・福永隆宏. "遺伝的アルゴリズムにおける実数値ベクトル表現，世代交代モデル，母集団分割効果の検討". 2002. より引用)
- [遺伝的アルゴリズムにおける実数値ベクトル表現，世代交代モデル，母集団分割効果の検討](https://is.doshisha.ac.jp/papers/pdf/03/200306_fukunaga.pdf)

### トーナメント選択
トーナメント選択：ランダムな数個体の中で一番高い個体を親とする選択方法
- [遺伝的アルゴリズムの代表的な選択方式の紹介およびそれらの性質について #ボルツマン選択 - Qiita](https://qiita.com/kanekanekaneko/items/1c563ece591fd2ba2127)

### 部分写像交叉 (Partially Mapped Crossover, PMX)
部分写像交叉：
1. 交叉点を2つ選ぶ
2. 子に親1(親2)の中間部分をコピーし、そのほかを親2(親1)のcitiesで埋める
3. マッピング関係を作る
4. 子の中で重複したcityをマッピングを使って修正する
- [Partially Mapped Crossover (PMX) Method](https://github.com/ruta-tamosiunaite/partially-mapped-crossover/blob/main/Readme.md)

## 結果
```bash
island_number = 4       # 島の数
paths_in_island = 100   # 島に含まれるpathの数
migration_rate = 0.2    # 各世代の生成後に、他の島に移動させるpathの割合
generations = 500       # 世代数   
```

| Challenge | Output | N (都市数) |
| :--- | :--- | :--- |
| 0 | 3291.62 | 5 |
| 1 | 3778.72 | 8 |
| 2 | 5130.60 | 16 | 
| 3 | 9732.72 | 64 |
| 4 | 14323.80 | 128 | 
| 5 | 26666.28 | 512 | 
| 6 | 59693.07 | 2048 |

所要時間：20分程度

## 改善できる点
- 世代数が十分でなかったため、C言語で実装するなどして実行時間を短くし、より多くの世代について計算する